// JavaScript bundler for docs/v3

import { readFileSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const files = [
  'lib/_energize.js',
  'lib/_dropdown.js',
  'lib/_lunr.js',
  'app/_search.js',
  'lib/_jquery_ui.js',
  'lib/_jquery.tocify.js',
  'lib/_imagesloaded.min.js',
  'app/_toc.js',
  'app/_version_dropdown.js',
  'app/_theme_toggle.js'
];

const sourceDir = join(__dirname, 'source/javascripts');
const outputFile = join(sourceDir, 'all.js');

let bundleContent = `// Auto-generated JavaScript bundle
// Generated by: npm run build:js
// Source files are in lib/ and app/ directories
// DO NOT edit this file directly - edit the source files and regenerate
`;

for (const file of files) {
  const filePath = join(sourceDir, file);
  const content = readFileSync(filePath, 'utf-8');
  const cleanContent = content
    .split('\n')
    .filter(line => !line.trim().startsWith('//= require'))
    .join('\n');

  bundleContent += `// From: ${file}\n`;
  bundleContent += cleanContent + ';\n\n';
}

writeFileSync(outputFile, bundleContent);
console.log(`âœ“ JavaScript bundle created: ${outputFile}`);
